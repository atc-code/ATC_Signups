<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ATC Carols — Signup</title>
  <style>
    :root { --max: 960px; --pad: 18px; --radius: 16px; --accent:#2b6cb0; }
    * { box-sizing: border-box; }
    body {
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      margin: 0;
      background: #f7f7fb;
      color:#1a202c;
    }
    header { background: #222; color: #fff; padding: 24px var(--pad); }
    header h1 {
      margin: 0 0 8px;
      font-size: clamp(1.6rem, 3.2vw, 2.2rem);
      line-height: 1.25;
    }
    header p  { margin: 0; opacity: .95; font-size: clamp(1rem, 2.2vw, 1.15rem); font-style: italic; }

    main {
      max-width: var(--max);
      margin: 20px auto;
      padding: 0 var(--pad);
      display:grid;
      gap:16px;
    }
    .card {
      background: #fff;
      border-radius: var(--radius);
      box-shadow: 0 6px 24px rgba(0,0,0,.08);
      padding: 18px;
    }
    .grid-2 { display:grid; grid-template-columns: 1fr 1fr; gap: 16px; }
    @media (max-width: 860px){ .grid-2{ grid-template-columns:1fr; } }

    fieldset { border: 0; padding: 0; margin: 0 0 12px; }
    legend {
      font-weight:800;
      margin-bottom: 10px;
      padding: 0;
    }
    .legend-main {
      font-size: 1.2rem;
    }

    label { font-weight: 600; display:block; margin-bottom: 6px; }
    input[type="text"], input[type="email"], textarea {
      width: 100%;
      padding: 12px 14px;
      border: 1px solid #d9dbe3;
      border-radius: 10px;
      font-size: 1rem;
      background:#fff;
    }
    input[readonly] {
      background:#edf2f7;
      cursor:not-allowed;
    }
    input[type="radio"] {
      width: 18px;
      height: 18px;
    }
    textarea { min-height: 90px; resize: vertical; }

    .teams {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px 18px;
      margin-top: 4px;
    }
    @media (max-width: 720px) { .teams { grid-template-columns: 1fr; } }
    .teams.singleColumn {
      grid-template-columns: 1fr;
    }

    .team {
      display: flex;
      gap: 10px;
      align-items: center;
      padding: 10px 12px;
      border:1px solid #e2e8f0;
      border-radius: 12px;
    }

    .req { color: #c00; margin-left: 4px; }
    .actions {
      display:flex;
      gap: 10px;
      align-items: center;
      margin-top: 16px;
      flex-wrap:wrap;
    }
    button {
      border: 0;
      padding: 12px 16px;
      border-radius: 10px;
      font-weight: 700;
      cursor: pointer;
      font-size:1rem;
    }
    .primary { background: var(--accent); color: #fff; }
    .secondary { background: #edf2f7; }

    .msg {
      margin-top: 14px;
      padding: 12px 14px;
      border-radius: 10px;
      display: none;
    }
    .success { background: #e6fffa; border: 1px solid #b2f5ea; color: #234e52; }
    .error   { background: #fff5f5; border: 1px solid #fed7d7; color: #742a2a; }

    h2 { margin:0 0 10px; font-size: clamp(1.1rem, 2.2vw, 1.3rem); }
    .chip {
      display:inline-block;
      margin:4px 6px 0 0;
      padding:4px 8px;
      border:1px solid #e2e8f0;
      border-radius:999px;
      font-size:.95rem;
    }
    .muted { color:#666; }
    .small { font-size:.9rem; }

    .tableWrap { overflow-x:auto; }
    table.roster, table.metrics { width:100%; border-collapse: collapse; }
    table.roster th, table.roster td,
    table.metrics th, table.metrics td {
      text-align:left;
      border-bottom:1px solid #e2e8f0;
      padding:10px 6px;
      vertical-align: top;
    }
    table.roster th, table.metrics th {
      font-size:.95rem;
      color:#334155;
    }

    .overlay {
      position:fixed;
      inset:0;
      background:#0f172a;
      color:#fff;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:24px;
      z-index:1000;
    }
    .overlay .inner { max-width:600px; text-align:center; }
    .overlay p{ opacity:.9; }

    .logo {
      height:88px;
      width:88px;
      border-radius:12px;
      background:#fff;
      padding:10px;
      box-shadow: 0 6px 20px rgba(0,0,0,.18);
    }
    .brandRow { position: relative; min-height: 104px; }
    .brandRow .logo{
      position: absolute;
      left: 18px;
      top: 50%;
      transform: translateY(-50%);
    }
    .brandRow > :nth-child(2){
      text-align: center;
      max-width: 900px;
      margin: 0 auto;
      text-wrap: balance;
      padding-left: 0;
    }

    footer { text-align:center; color:#374151; padding: 16px; }

    .hero {
      background:#0f172a;
      color:#e5e7eb;
      border:0;
      text-align:center;
    }
    .hero h2 {
      font-size: clamp(1.2rem, 3vw, 1.6rem);
      margin:0 0 8px;
      color:#fff;
    }
    .hero p {
      margin:0;
      font-size: clamp(1rem, 2.2vw, 1.15rem);
    }

    @media (max-width: 560px){
      header .brandRow{ min-height: 120px; padding-top: 12px; }
      header .brandRow .logo{ top: 12px; transform: none; height: 64px; width: 64px; }
      header .brandRow > :nth-child(2){
        max-width: 92%;
        margin: 0 auto;
        padding-left: 72px;
      }
      header h1{ font-size: clamp(1.2rem, 6vw, 1.8rem); }
    }
  </style>

  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <script src="ATC_Carols.js"></script>
</head>
<body>
  <!-- Sign-in overlay -->
  <div id="signinOverlay" class="overlay" style="display:none">
    <div class="inner">
      <div class="brandRow" style="justify-content:center;margin-bottom:8px;">
        <img src="https://raw.githubusercontent.com/atc-code/ATC_Signups/main/images/ATC_Logo1.png" alt="Church Logo" class="logo" />
        <h2 style="margin:0">Sign in to register for ATC Carols</h2>
      </div>
      <p>Please sign in with your Google account to access this ATC Carols Signup page.</p>
      <div id="gSignIn" style="display:inline-block;"></div>
      <div class="subtle" style="margin-top:10px;">Your email is used to confirm and manage your Carols signup.</div>
    </div>
  </div>

  <!-- App -->
  <div id="app" style="display:none">
    <header>
      <div class="brandRow">
        <img src="https://raw.githubusercontent.com/atc-code/ATC_Signups/main/images/ATC_Logo1.png" alt="Church Logo" class="logo" />
        <div>
          <h1 id="pageTitle">ATC Carols — Signup</h1>
          <p>Luke 2:14 — “Glory to God in the highest, and on earth peace, goodwill toward men.”</p>
        </div>
      </div>
    </header>

    <main>
      <!-- Big banner after Carols signups close -->
      <section class="card hero" id="closedBanner" style="display:none">
        <h2>Carols signups are now closed.</h2>
        <p>Thank you for opening your homes and hearts. See you next year!</p>
      </section>

      <!-- Submit form (visible only while signups are open) -->
      <section class="card" id="formCard">
        <form id="signupForm" autocomplete="on">
          <fieldset>
            <legend class="legend-main">Contact Information</legend>
            <div class="grid-2">
              <div>
                <label for="firstName">First Name<span class="req">*</span></label>
                <input
                  id="firstName"
                  name="firstName"
                  type="text"
                  required
                  minlength="2"
                  pattern="[A-Za-z][A-Za-z\s\-']{1,}"
                  placeholder="e.g., John"
                />
              </div>
              <div>
                <label for="lastName">Last Name<span class="req">*</span></label>
                <input
                  id="lastName"
                  name="lastName"
                  type="text"
                  required
                  minlength="2"
                  pattern="[A-Za-z][A-Za-z\s\-']{1,}"
                  placeholder="e.g., Doe"
                />
              </div>
            </div>

            <div class="grid-2">
              <div>
                <label for="email">Email<span class="req">*</span></label>
                <input
                  id="email"
                  name="email"
                  type="email"
                  required
                  readonly
                  placeholder="Signed-in email"
                  title="Email is taken from your Google sign-in."
                />
              </div>
              <div>
                <label for="phone">Phone<span class="req">*</span></label>
                <input
                  id="phone"
                  name="phone"
                  type="text"
                  inputmode="tel"
                  required
                  placeholder="(###) ###-####"
                />
              </div>
            </div>

            <div>
              <label for="address">Address for Carols visit<span class="req">*</span></label>
              <input
                id="address"
                name="address"
                type="text"
                required
                placeholder="Street, City, State ZIP"
              />
            </div>

            <div>
              <label for="parking">Parking instructions (if any)</label>
              <textarea
                id="parking"
                name="parking"
                placeholder="Gate codes, street parking info, special instructions…"
              ></textarea>
            </div>
          </fieldset>

          <div class="divider"></div>

          <fieldset>
            <legend>Carols date &amp; hosting</legend>
            <div class="grid-2">
              <div>
                <label>Choose your Carols date<span class="req">*</span></label>
                <div id="dateOptions" class="teams singleColumn">
                  <div class="muted">Loading available dates…</div>
                </div>
              </div>
              <div>
                <label>Host meal (optional)</label>
                <div id="hostOptions" class="teams singleColumn">
                  <label class="team">
                    <input type="radio" name="hostType" value="none" checked />
                    <span>Not hosting meal</span>
                  </label>
                  <label class="team">
                    <input type="radio" name="hostType" value="Lunch" />
                    <span>Host Lunch</span>
                  </label>
                  <label class="team">
                    <input type="radio" name="hostType" value="Dinner" />
                    <span>Host Dinner</span>
                  </label>
                </div>
                <div id="hostStatusMsg" class="muted small"></div>
              </div>
            </div>
          </fieldset>

          <fieldset>
            <label for="comments">Comments / notes</label>
            <textarea
              id="comments"
              name="comments"
              placeholder="Any special requests or timing preferences…"
            ></textarea>
          </fieldset>

          <div class="actions">
            <button class="primary" type="submit" id="submitBtn">Submit</button>
            <button class="secondary" type="reset">Clear</button>
          </div>

          <div id="success" class="msg success">
            Thank you! Your Carols signup was recorded.
          </div>
          <div id="error" class="msg error">
            Sorry, something went wrong. Please try again or contact the coordinator.
          </div>
        </form>
      </section>

      <!-- Live signup always visible -->
      <section class="card" id="rosterCard">
        <h2 style="margin-top:0;">LIVE Carols Signup Status</h2>
        <p class="muted small">
          Shows which homes have signed up for each Carols date.
        </p>
        <div class="tableWrap">
          <table class="roster" id="rosterTable">
            <thead>
              <tr>
                <th>Date</th>
                <th>Homes / Families</th>
              </tr>
            </thead>
            <tbody id="rosterBody">
              <tr><td colspan="2" class="muted">Loading…</td></tr>
            </tbody>
          </table>
        </div>
        <div id="rosterError" class="msg error" style="display:none;"></div>
      </section>

      <!-- Admin metrics always visible to admins -->
      <section class="card" id="adminMetrics" style="display:none">
        <h2 style="margin-top:0">Admin — Activity Metrics</h2>
        <div class="muted" id="metricsTotals" style="margin-bottom:8px"></div>
        <div class="tableWrap">
          <table class="metrics" id="metricsTable">
            <thead><tr><th>Email</th><th>Submits</th><th>Views</th></tr></thead>
            <tbody id="metricsBody"><tr><td colspan="3" class="muted">Loading…</td></tr></tbody>
          </table>
        </div>
      </section>
    </main>

    <footer></footer>
  </div>
</body>
</html>
